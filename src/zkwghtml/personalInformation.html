<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>个人资料</title>
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/shopping-mall-index.css" />
		<link rel="stylesheet" href="layui/css/layui.css" />
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/zhonglin.js"></script>
		<script type="text/javascript" src="js/login.js"></script>
		<script type="text/javascript" src="js/checkLogin.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<script src="js/search.js" type="text/javascript" charset="utf-8"></script>
		<script src="layui/layui.js"></script>
	</head>

	<body style="position:relative;">

		<!--top 开始-->
		<div class="top">
			<div class="top-con w1200">
				<p class="t-con-l f-l">您好，欢迎来到宅客微购</p>
				<ul class="t-con-r f-r">
					<li><span id="span_id"></span><a href="personalCenter.html">我 (个人中心)</a></li>
					<li><span id="exit_spn"></span></li>
					<li><a href="#">我的购物车</a></li>
					<li><a href="myorder.html">我的订单</a></li>
					<li class="erweima">
						<a href="#">扫描二维码</a>
						<div class="ewm-tu">
							<a href="#"><img src="images/erweima-tu.jpg" /></a>
						</div>
					</li>
					<div style="clear:both;"></div>
				</ul>
				<div style="clear:both;"></div>
			</div>
		</div>

		<!--logo search 开始-->
		<div class="hd-info1 w1200">
			<div class="logo f-l">
				<h1><a href="#" title="中林网站"><img src="images/logo.jpg" /></a></h1>
			</div>
			<div class="search f-r">
				<ul class="sp">
					<li class="current" ss-search="sp"><a href="JavaScript:;">商品</a></li>
					<li ss-search="dp"><a href="JavaScript:;">店铺</a></li>
					<div style="clear:both;"></div>
				</ul>
				<div class="srh">
					<div class="ipt f-l">
						<input id="searchGoods" type="text" placeholder="搜索商品..." ss-search-show="sp" />
						<input type="text" placeholder="搜索店铺..." ss-search-show="dp" style="display:none;" />
					</div>
					<button onclick="searchGoods()" class="f-r">搜 索</button>
					<div style="clear:both;"></div>
				</div>
				<ul class="sp2">
					<li><a href="#">绿豆</a></li>
					<li><a href="#">大米</a></li>
					<li><a href="#">驱蚊</a></li>
					<li><a href="#">洗面奶</a></li>
					<li><a href="#">格力空调</a></li>
					<li><a href="#">洗发护发</a></li>
					<li><a href="#">葡萄 </a></li>
					<li><a href="#">脉动</a></li>
					<li><a href="#">海鲜水产</a></li>
					<div style="clear:both;"></div>
				</ul>
			</div>
			<div style="clear:both;"></div>
		</div>

		<!--nav 开始-->
		<div id="level" class="nav w1200">
				<a href="JavaScript:;" class="sp-kj" kj="">
					商品分类快捷入口
				</a>
				<div class="kj-show2 none" kj-sh="">
					<div v-for="lev1 in levels">
						<div v-for="lev2 in lev1.lev2TypeDtoList">
							<div class="kj-info1" mg="shiping">
								<dl class="kj-dl1">
									<dt>
										<a href="#">{{lev2.name}}</a>
									</dt>
									<dd>
										<div v-for="lev3 in lev2.lev3TypeDtoList" style="display: inline;">
											<a style="color: white;" href="javascript:void(0)" v-bind:id=lev3.id @click="toSearch($event)">{{lev3.name}}</a>&nbsp;
										</div>
									</dd>
								</dl>
								<div class="kj-if-show" mg2="shiping">
									<div v-for="lev2 in lev1.lev2TypeDtoList">
										<dl>
											<dt>{{lev2.name}}</dt>
											<dd>
												<div v-for="lev3 in lev2.lev3TypeDtoList">
													<a href="#">{{lev3.name}}</a>
												</div>
											</dd>
											<div style="clear:both;"></div>
										</dl>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<ul v-for="g in levels">
					<li>
						<div v-if="g.id === 1">
							<a href="mallindex.html">{{g.name}}</a>
						</div>
						<div v-else>
							<a href="javascript:void(0)">{{g.name}}</a>
						</div>
					</li>
					<div style="clear:both;"></div>
				</ul>
				<div style="clear:both;"></div>
			</div>
		<!--内容开始-->
		<div class="personal w1200">
			<div class="personal-left f-l">
				<div class="personal-l-tit">
					<h3>个人中心</h3>
				</div>
				<ul>
					<li class=" per-li1"><a href="personalCenter.html">消息中心<span>></span></a></li>
					<li class="current-li per-li2"><a href="personalInformation.html">个人资料<span>></span></a></li>
					<li class="per-li3"><a href="myorder.html">我的订单<span>></span></a></li>
					<li class="per-li4"><a href="#">我的预约<span>></span></a></li>
					<li class="per-li5"><a href="#">购物车<span>></span></a></li>
					<li class="per-li6"><a href="receiveAddress.html">管理收货地址<span>></span></a></li>
					<li class="per-li7"><a href="#">店铺收藏<span>></span></a></li>
					<li class="per-li8"><a href="#">购买记录<span>></span></a></li>
					<li class="per-li9"><a href="#">浏览记录<span>></span></a></li>
					<li class="per-li10"><a href="#">会员积分<span>></span></a></li>
				</ul>
			</div>
			<div class="personal-r f-r">
				<div class="personal-right">
					<div class="personal-r-tit">
						<h3>个人资料</h3>
					</div>
					<div class="data-con" id="data">
						<div class="dt1">
							<p class="f-l">当前头像：</p>
							<div class="touxiang f-l">
								<div class="tu f-l">
									<a href="#">
										
										<img v-if="address.img_url==null" id="user_img" src="images/data-tu.gif" />
										<img v-if="address.img_url!=null" id="user_img" :src="address.img_url" />
										<!--<input type="file" name="" id="" class="img1" />-->
									</a>
								</div>
								<button type="button" class="layui-btn" id="test1">
 				 		<i class="layui-icon">&#xe67c;</i>上传图片
						</button>
								<div style="clear:both;"></div>
							</div>
							<div style="clear:both;"></div>
						</div>
						<div>
							
						</div>
						<div class="dt1">
							<p class="dt-p f-l">昵称：</p>
							<input type="text" placeholder="请输入昵称" id="a" v-model:value="address.nickname" />
							<div style="clear:both;"></div>
						</div>
						<div class="dt1">
							<p class="dt-p f-l">用户名：</p>
							<input type="text" value="zhao601884596" id="b" v-model:value="address.username" />
							<div style="clear:both;"></div>
						</div>
						<div class="dt1 dt2">
							<p class="dt-p f-l">性别：</p>
							<div>
								<input type="radio" id="boy" name="hobby" value="1"></input><span>男</span>
							</div>
							<div>
								<input type="radio" id="girl" name="hobby" value="0"></input><span>女</span>
							</div>
							<div style="clear:both;"></div>
						</div>
						<!--<div class="dt1">
							<p class="dt-p f-l">年龄：</p>
							<input type="number" value="20" id="age" />
							<div style="clear:both;"></div>
						</div>-->
						<div class="dt1">
							<p class="dt-p f-l">生日：</p>
							<input type="date" id="birthday" v-model:value="address.birthday" />
							<div style="clear:both;"></div>
						</div>
						<!--<div class="dt1 dt3">
                    	<p class="dt-p f-l">手机号：</p>
                        <input type="text" value="12345678910" />
                        <button>获取短信验证码</button>
                        <div style="clear:both;"></div>
                    </div>
                    <div class="dt1">
                    	<p class="dt-p f-l">验证码：</p>
                        <input type="text" value="" />
                        <div style="clear:both;"></div>
                    </div>-->
						<!--<div class="dt1">
                    	<p class="dt-p f-l">邮箱：</p>
                        <input type="text" value="601884596@qq.com" readonly="readonly"/>
                        <div style="clear:both;"></div>
                    </div>-->
						<!--<div class="dt1 dt4">
                    	<p class="dt-p f-l">密码：</p>
                        <input type="text" value="" />
                        <button>修改密码</button>
                        <div style="clear:both;"></div>
                    </div>-->
						<button class="btn-pst" @click="save">保存</button>

					</div>
				</div>
			</div>
			<div style="clear:both;"></div>
		</div>

		<!--上传头像弹窗
    <div class="tanchuang">
    	<div class="t-c-bg"></div>
    	<div class="t-c-con">
        	<div class="tc-tit">
            	<h3>上传头像</h3>
                <a href="JavaScript:;" delete=""><img src="images/t-c-del.gif" /></a>
                <div style="clear:both;"></div>
            </div>
            <div class="tc-con">
            	<a href="#"><img src="images/tc-tu.gif" /></a>
                <button>保存头像</button>
            </div>
        </div>
    </div>-->

		<!--底部服务-->
		<div class="ft-service">
			<div class="w1200">
				<div class="sv-con-l2 f-l">
					<dl>
						<dt><a href="#">新手上路</a></dt>
						<dd>
							<a href="#">购物流程</a>
							<a href="#">在线支付</a>
						</dd>
					</dl>
					<dl>
						<dt><a href="#">配送方式</a></dt>
						<dd>
							<a href="#">货到付款区域</a>
							<a href="#">配送费标准</a>
						</dd>
					</dl>
					<dl>
						<dt><a href="#">购物指南</a></dt>
						<dd>
							<a href="#">常见问题</a>
							<a href="#">订购流程</a>
						</dd>
					</dl>
					<dl>
						<dt><a href="#">售后服务</a></dt>
						<dd>
							<a href="#">售后服务保障</a>
							<a href="#">退款说明</a>
							<a href="#">新手选购商品总则</a>
						</dd>
					</dl>
					<dl>
						<dt><a href="#">关于我们</a></dt>
						<dd>
							<a href="#">投诉与建议</a>
						</dd>
					</dl>
					<div style="clear:both;"></div>
				</div>
				<div class="sv-con-r2 f-r">
					<p class="sv-r-tle">187-8660-5539</p>
					<p>周一至周五9:00-17:30</p>
					<p>（仅收市话费）</p>
					<a href="#" class="zxkf">24小时在线客服</a>
				</div>
				<div style="clear:both;"></div>
			</div>
		</div>

		<!--底部 版权-->
		<div class="footer w1200">
			<p>
				<a href="#">关于我们</a><span>|</span>
				<a href="#">友情链接</a><span>|</span>
				<a href="#">宅客微购社区</a><span>|</span>
				<a href="#">诚征英才</a><span>|</span>
				<a href="#">商家登录</a><span>|</span>
				<a href="#">供应商登录</a><span>|</span>
				<a href="#">热门搜索</a><span>|</span>
				<a href="#">宅客微购新品</a><span>|</span>
				<a href="#">开放平台</a>
			</p>
			<p>
				沪ICP备13044278号<span>|</span>合字B1.B2-20130004<span>|</span>营业执照<span>|</span>互联网药品信息服务资格证<span>|</span>互联网药品交易服务资格证
			</p>
		</div>
		<script src="js/jquery-1.4.2.min.js"></script>
		<script>
			//localStorage.setItem("zkwgtoken", "224dece0a0a24c64bb308c099cd21869_1");
			var t = localStorage.getItem("zkwgtoken");
			var vm = new Vue({
				el: "#data",
				data: {
					address: [],
					count: 0,
				},
				beforeMount: function() {
					//localStorage.setItem("zkwgtoken", "224dece0a0a24c64bb308c099cd21869_1");
					var t = localStorage.getItem("zkwgtoken");
					axios({
						method: "post",
						url: "http://47.94.193.104:8080/zkshopping/api/user/selectUserById",
						data: {
							//`data` 是作为请求主体被发送的数据
						},
						headers: {
							zkwgtoken: t
						},
						params: {
							// 通过url发送参数
						},
						responseType: 'json'
					}).then(function(res) {
						console.log(res.data);
						vm.address = res.data.data;
						var birthday = res.data.data.birthday;
						//var age=jsGetAge(birthday)
						//console.log(age);
						//$("#age").val(age);
						var gender = res.data.data.gender;
						console.log(gender);
						if (gender == 0) {
							$("#boy").attr("checked", "checked");
						} else if (gender == 1) {
							$("#girl").attr("checked", "checked");
						}
						console.log(birthday)
					})
				},
				methods: {
					save: function() {
						var user = vm.address
						var nickname = user.nickname;
						var username = user.username;
						var gender = 0;
						if ($("#boy").attr("checked")) {
							gender = 0;
						} else if ($("#girl").attr("checked")) {
							gender = 1;
						}
						var age = $("#age").val();
						var img_url=$("#user_img").attr("src");
						var birthday=$("#birthday").val();
						console.log("修改");
						var t = localStorage.getItem("zkwgtoken");
						axios({
							method: "post",
							url: "http://47.94.193.104:8080/zkshopping/api/user/updateUser",
							data: {
								//`data` 是作为请求主体被发送的数据
								'nickname': nickname,
								'username': username,
								'img_url': img_url,
								'gender': gender,
								'birthday': birthday,
							},
							headers: {
								zkwgtoken: t
							},
							params: {
								// 通过url发送参数
							},
							responseType: 'json'
						}).then(function(res) {
							console.log(res);
							if (res.data.code == 200) {
								alert("修改成功");
								console.log("修改成功");
//								windows.reload();
								location.href=location.href;
							} else {
								console.log("修改失败");
							}
						})
					}
				}
			});
			//			  
			//			  var app = new Vue({
			//						  el: '#data',   //设置标签 只支持ID
			//						  data: {  //数据源
			//							msgs:["Java","Ruby","Go","Python"],
			//							jobs:[]
			//						  }
			//						})
			//			  
			//			  function save () {
			//			  		axios({
			//								method: "post",
			//								url: "http://localhost:8080/api/ReceverAddressInfo/deleteAddress/" + id,
			//								headers: {
			//									zkwgtoken: token
			//								},
			//								params: {
			//									// 通过url发送参数
			//								},
			//								responseType: 'json'
			//							})
			//			  }
			//			  
			//			$(function() {
			//				localStorage.setItem("zkwgtoken", "01ae8bc31c7f4152bbcd81a22cb8c8fc_1");
			//				var t = localStorage.getItem("zkwgtoken");
			//				console.log(t);
			//				//       var  email = 1796431192@qq.com;
			//				$.ajax({
			//					url: "http://127.0.0.1:8080/api/user/selectUserByEmail",
			//					type: "post",
			//					//url:"http://localhost:8080/api/user/selectUserByEmail" + email,
			//					
			//					headers: {
			//						"zkwgtoken": 123
			//					},
			//					async: false,
			//					
			//					success: function(data) {
			//						console.log(data);
			//						var cod = data.data;
			//						$("#a").val(data.nickname);
			//						$("#b").val(data.username);
			//						$('input:radio[name="hobby"]:checked').val(data.gender);
			//						
			//						var birth = $("#c").val(data.birthday);
			////						var age=jsGetAge(data.birthday);
			//                      var age=jsGetAge(birth);
			//					},
			////					contentType: "application/json"
			//				});
			//			})
			function jsGetAge(strBirthday) {
				var returnAge;
				var strBirthdayArr = strBirthday.split("-");
				var birthYear = strBirthdayArr[0];
				var birthMonth = strBirthdayArr[1];
				var birthDay = strBirthdayArr[2];
				d = new Date();
				var nowYear = d.getFullYear();
				var nowMonth = d.getMonth() + 1;
				var nowDay = d.getDate();
				if (nowYear == birthYear) {
					returnAge = 0; //同年 则为0岁      
				} else {
					var ageDiff = nowYear - birthYear; //年之差          
					if (ageDiff > 0) {
						if (nowMonth == birthMonth) {
							var dayDiff = nowDay - birthDay; //日之差                  
							if (dayDiff < 0) {
								returnAge = ageDiff - 1;
							} else {
								returnAge = ageDiff;
							}
						} else {
							var monthDiff = nowMonth - birthMonth; //月之差                  
							if (monthDiff < 0) {
								returnAge = ageDiff - 1;
							} else {
								returnAge = ageDiff;
							}
						}
					} else {
						returnAge = -1; //返回-1 表示出生日期输入错误 晚于今天          
					}
				}
				return returnAge; //返回周岁年龄        
			}
		</script>
		<script>
			layui.use('upload', function() {
				var upload = layui.upload;
				//执行实例
				var uploadInst = upload.render({
					elem: '#test1' //绑定元素
						,
					url: 'http://47.94.193.104:8080/zkshopping/api/oss/upload' //上传接口
						,
					done: function(res) {
						$("#user_img").attr("src",res.data.data);
						//上传完毕回调
					},
					error: function() {
						//请求异常回调
					}
				});
			});
		</script>
	</body>
	<script>
		// prod 线上环境
		var baseUrl = "http://47.94.193.104:8080/zkshopping/api";
		// dev 开发环境
		//var baseUrl = "http://localhost:8080/api";

		// 页面加载完成时的操作
		$(function() {
			// 获取商品分类
			getAll();
		});

		// 创建 Vue 对象，用于承载页面渲染需要的数据
		var app = new Vue({
			el: "#level",
			data: {
				levels: []
			},
			methods: {
				toSearch: function(e) {
					var typeId = e.currentTarget.id;
					goToSearch(typeId);
				}
			}
		});

		function getAll() {
			var url = baseUrl + "/goodsInfo/level";
			// Ajax GET 异步请求
			$.get(url, function(r) {
				// console.log(r.code + " " + r.msg);
				if (r.code === 200) {
					app.levels = r.data;
				}
			});
		}
	</script>
</html>